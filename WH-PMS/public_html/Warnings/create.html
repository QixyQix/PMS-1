<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../style.css" type="text/css"/>
        <script src="https://www.gstatic.com/firebasejs/3.7.5/firebase.js"></script>
    </head>
    <body>
        <!--Start Menu-->
        <div id="menu">
            <img src="../img/logo.png" width="90%"/>
            <p>Player record Management System
                <br>Indev v0.2.1</p>
            <ul id="menulist">
                <li><strong>Home</strong></li>
                <li><a href="players.html"/>Players Information</a></li>
                <li><a id="signOut">Sign Out</a></li>
            </ul>
        </div>
        <!--End Menu-->

        <!--Start Content-->
        <div id="content">
            <div id="contenttop">
            </div>
            <div id="contentMain">
                <h1>New Warning Record</h1>
                <hr/>

                <div class='heading'>1. Get user's UUID</div>
                <br/>
                <div>
                    <div class='width50 floatLeft'>
                        <form>
                            <label for='txtUsername'>Username:</label>
                            <input type='text' id='txtUsername' placeholder='e.g. Minerboy100'/>
                            <button type='button' id='btnQueryUUID'>Get UUID</button>
                            <br/><p id='resolveUUIDError' class='red'></p>
                        </form>
                    </div>

                    <div class='width50 floatLeft'>
                        <p id='resolvedName'></p>
                        <img id='resolvedAvatar' src='' width='15%'/><br/>
                        <p id='resolvedUUID'></p><br/>
                    </div>
                </div>


                <div class='heading clearLeft'>2. Fill out the remaining details</div>
                <p class="red" id="errorMsg"></p>
                <form>
                    <div class='formBlock'>
                        <label for='txtUUID'>Offender's UUID: </label>
                        <input type='text' id="txtUUID"  placeholder="e.g. 0a31041a-9f36-43f9-9857-8fc90faf3501"/>
                    </div>
                    <div class='formBlock'>
                        <label for='txtIssuedBy'>Issued By:</label>
                        <input type='text' id='txtIssuedBy'  placeholder="e.g. y0urs_Tru1y"/>
                    </div>
                    <div class='formBlock'>
                        <label for='txtIssuedOn'>Issued On:</label>
                        <input type='date' id='txtIssuedOn'/>
                    </div>
                    <div class='formBlock'>
                        <label for='txtReason'>Reason:</label>
                        <textarea id="txtReason" rows="4" placeholder="e.g. Griefing a player's house in sandbox"></textarea>
                    </div>
                    <div class='formBlock'>
                        <button type="button" id="saveButton">Save</button>
                    </div>
                </form>
                <p class="centerText">Copyright &COPY; 2017, WolvHaven Dev</p>
            </div>
        </div>
        <!--End Content-->
        <script src="../javascript/firebaseSetup.js"></script>
        <script src="../javascript/authentication.js"></script>
        <script>
            var btnGetUUID = document.getElementById('btnQueryUUID');
            btnGetUUID.addEventListener('click', getUUID);

            var txtUUID = document.getElementById('txtUUID');

            function getUUID() {
                var username = document.getElementById('txtUsername').value;

                var xhttp = new XMLHttpRequest();
                xhttp.open("GET", "https://api.mojang.com/users/profiles/minecraft/" + username, false);
                xhttp.send();
                
                try{
                var response = JSON.parse(xhttp.responseText);

                if (response.id !== null) {
                    var uuid = response.id;

                    var convertedUUID = convertUUID(uuid);
                    txtUUID.value = convertedUUID;

                    var resolvedName = document.getElementById('resolvedName');
                    var resolvedAvatar = document.getElementById('resolvedAvatar');
                    var resolvedUUID = document.getElementById('resolvedUUID');
                    document.getElementById('resolveUUIDError').innerHTML = "";
                    
                    resolvedName.innerHTML = username;
                    resolvedAvatar.src = "https://crafatar.com/renders/body/" + convertedUUID;
                    resolvedUUID.innerHTML = convertedUUID;
                }
            }catch(err){
                document.getElementById('resolveUUIDError').innerHTML = "Player does not exist!";
            }
            }


            function convertUUID(uuid) {
                var convertedUUID = "";
                convertedUUID += uuid.substring(0, 8) + "-";
                convertedUUID += uuid.substring(8, 12) + "-";
                convertedUUID += uuid.substring(12, 16) + "-";
                convertedUUID += uuid.substring(16, 20) + "-";
                convertedUUID += uuid.substring(20);

                return convertedUUID;
            }

            function addWarning() {
                var testRef = firebase.database().ref("Players/");

                var newBanRef = testRef.child("Bans").push();
                newBanRef.set({
                    Date: "08/04/2017",
                    Reason: "Spamming fuck in chat",
                    Duration: "",
                    IssuedBy: "y0urs_Tru1y"
                });
            }

        </script>
</html>
